<!doctype html>
<html lang="en">
<head>
  
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Mining Exam">
<link rel="apple-touch-icon" href="url('https://img1.wsimg.com/isteam/ip/0bf70def-deca-417e-962f-b76f39b1865e/mine-haul-truck-banner.jpg');">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GATE-style Mining Exam — 65 Qs</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --accent:#FFD700;
  --bg-panel: rgba(18,18,20,0.66);
  --card-border: rgba(255,255,255,0.06);
  --muted: rgba(255,255,255,0.84);
  --correct: #28a745;
  --wrong: #e5534b;

  /* New legend colors */
  --answered: #2ecc71;     /* green */
  --review: #3498db;       /* blue */
  --not-visited: #7f8c8d;  /* grey */
  --not-answered: #e74c3c; /* red */
}

/* your existing CSS… */

/* ✅ Add legend styling here */
.legend {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  margin-top: 12px;
  font-size: 13px;
  color: var(--muted);
}

.legend div {
  display: flex;
  align-items: center;
  gap: 6px;
}

.legend span {
  width: 14px;
  height: 14px;
  display: inline-block;
  border-radius: 3px;
}

/* count styles (minimal, color-coded) */
.legend .count {
  font-weight: 700;
  margin-left: 6px;
  color: var(--muted);
}
.legend .count.answered { color: var(--answered); }
.legend .count.review { color: var(--review); }
.legend .count.not-visited { color: var(--not-visited); }
.legend .count.not-answered { color: var(--not-answered); }

*{box-sizing:border-box;margin:0;padding:0}
html,body{  height:100%;  font-family: "Times New Roman", Times, serif;  background:#000;  color:#fff;}

.container-wrap{
  min-height:100vh;
  background-image: url('https://img1.wsimg.com/isteam/ip/0bf70def-deca-417e-962f-b76f39b1865e/mine-haul-truck-banner.jpg');
  background-size:cover;background-position:center center;
  display:flex;align-items:center;justify-content:center;position:relative;
}
.overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6));z-index:0}
.card{position:relative;z-index:2;background:var(--bg-panel);border-radius:14px;padding:18px;backdrop-filter:blur(8px);border:1px solid var(--card-border);box-shadow:0 20px 60px rgba(0,0,0,0.6);width:1100px;max-width:96%}
.welcome{padding:30px;text-align:center}
.welcome h1{color:var(--accent);margin-bottom:6px}
.welcome p{color:var(--muted);margin-bottom:12px}
.btn{padding:10px 16px;border-radius:8px;border:none;background:var(--accent);color:#000;font-weight:700;cursor:pointer;font-size:16px}
.btn.ghost{padding:10px 16px;border-radius:8px;border:none;background:white;color:#000;font-weight:700;cursor:pointer;font-size:16px}
.btn.gho{padding:10px 16px;border-radius:8px;border:none;background:#3498db;color:#000;font-weight:700;cursor:pointer;font-size:16px}
.btn.ghos{padding:10px 16px;border-radius:8px;border:none;background:#D3B683;color:#000;font-weight:700;cursor:pointer;font-size:16px}
.btn.ghostt{padding:10px 16px;border-radius:8px;border:none;background:#2ecc71;color:#000;font-weight:700;cursor:pointer;font-size:16px}
.layout{display:flex;gap:16px;margin-top:12px}
.left{flex:1 1 68%}
.right{flex-basis:32%;min-width:260px}
.qmeta{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.qnum{font-size:14px;color:var(--muted)}
.qtext{font-size:18px;margin:10px 0;line-height:1.35}
.options{display:flex;flex-direction:column;gap:8px}
.opt{padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);cursor:pointer;text-align:left}
.opt.selected{outline:2px solid rgba(255,204,0,0.6)}
.timer{font-weight:700;color:var(--accent);font-size:24px;text-align:right}
.palette{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
.pmini {width: 36px;  height: 36px;  border-radius: 8px;  background: var(--not-visited);  display: flex;  align-items: center;  justify-content: center;  cursor: pointer;  border: 1px solid rgba(255,255,255,0.04);  color: #fff;  font-weight: 600;}
.pmini.answered {  background: var(--answered);}
.pmini.not-answered {  background: var(--not-answered);}
.pmini.review {  background: var(--review);  color: #fff;}
.pmini.active { outline: 3px solid var(--accent); }
.pmini.active{outline:3px solid rgba(255,204,0,0.4)}
.controls{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.small{font-size:13px;color:var(--muted)}
.submit-area{text-align:center;margin-top:12px}
.result-wrap{text-align:center;margin-top:16px;color:var(--muted)}
.review-ui{display:none;margin-top:18px}
.answer-correct{color:var(--accent);font-weight:700}
.answer-wrong{color:var(--wrong);font-weight:700}
.footer{margin-top:10px;font-size:12px;color:var(--muted);text-align:center}
.hidden{display:none}
.modal-overlay{
  position:fixed; inset:0; background: rgba(0,0,0,0.75);
  display:flex; align-items:center; justify-content:center; z-index:9999;
}
.modal{
  background:#0b0b0b; padding:28px; border-radius:12px; text-align:center; max-width:420px; width:90%;
  box-shadow:0 10px 40px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.04);
}
.modal h2{Color:var(--accent); margin-bottom:8px}
.modal p{color:#fff; font-size:1.1rem}
.modal button{margin-top:16px}
@media (max-width:1000px){.layout{flex-direction:column}.right{order:-1}}
</style>

<!-- KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
  onload="if(typeof renderMathInElement==='function'){ renderMathInElement(document.body, { delimiters: [{left:'$$', right:'$$', display:true}, {left:'\\(', right:'\\)', display:false}] }); }">
</script>
</head>
<body>
<div class="container-wrap">
  <div class="overlay" aria-hidden="true"></div>

  <div class="card" role="application" aria-label="GATE style mining quiz">

    <!-- WELCOME -->
    <div id="welcome" class="welcome" aria-live="polite">
      <div style="text-align:center; margin-bottom:12px;">
        <img src="https://img1.wsimg.com/isteam/ip/0bf70def-deca-417e-962f-b76f39b1865e/logo.png"
             alt="Indian Coal Chronicles Logo"
             style="max-width:100px; height:auto; display:inline-block;"/>
      </div>
      <h1>Welcome to Indian Coal Chronicles</h1>
      <p><strong>GATE - Mining Practice Paper</strong>.</p>
      <div style="text-align:left;max-width:820px;margin:12px auto;color:var(--muted);">
        <strong>Instructions:</strong>
    <ol style="margin-top: 8px; line-height: 1.6;">
      <li>This paper comprises two sections: <strong>General Aptitude (GA)</strong> and <strong>Mining Subject (MN)</strong>.</li>
      <li>The duration of the examination is <strong> 3 hours</strong>.</li>
      <li><strong>Questions 1–10</strong> pertain to General Aptitude, while <strong>Questions 11–65</strong> relate to the Mining Subject, making up a total of <strong>100 marks</strong>.</li>
      <li>
        The types of questions included are as follows:
        <ol type="a" style="margin-top: 4px; margin-left: 32px; list-style-type: lower-alpha;">
          <li>Multiple Choice Questions <strong>(MCQ)</strong></li>
          <li>Multiple Select Questions <strong>(MSQ)</strong></li>
          <li>Numerical Answer Type <strong>(NAT)</strong> questions</li>
        </ol>
      </li>
      <li>Marking Scheme: Each question carries either <strong>1 mark</strong> or <strong>2 marks</strong>.</li>
      <li>
        Negative Marking:
        <ol type="a" style="margin-top: 4px; margin-left: 32px; list-style-type: lower-alpha;">
          <li>Negative marking applies only to MCQ-type questions.</li>
          <li>For a 1-mark MCQ, <strong>1/3 mark</strong> will be deducted for each incorrect response.</li>
          <li>For a 2-mark MCQ, <strong>2/3 mark</strong> will be deducted for each incorrect response.</li>
          <li><strong>No negative marking</strong> will be applied for incorrect answers to MSQ or NAT questions.</li>
          <li><strong>No partial marking</strong> is applicable for MSQ questions.</li>
        </ul>
      </div>
      <button id="startBtn" class="btn ghostt">Start</button>
    </div>

    <!-- QUIZ UI -->
<div id="quizUI" class="hidden" aria-hidden="true">
  <div class="layout">
    <div class="left">
      <div class="qmeta">
        <div class="qnum" id="qnum">Question 1 / 65</div>
        <div class="timer" id="timer">3:00:00</div>
      </div>

      <div class="qtext" id="qtext">Loading...</div>
      <div class="options" id="options" role="group" aria-labelledby="qtext"></div>

      <div class="controls">
        <div>
          <button id="clearBtn" class="btn ghost" aria-label="Clear selected option">Clear</button>
          <button id="prevBtn" class="btn ghos" aria-label="Previous question">Previous</button>
          <button id="nextBtn" class="btn" aria-label="Save and go to next question">Save & Next</button>
          <button id="saveMarkBtn" class="btn gho" aria-label="Save and mark for review">Save & Mark for Review</button>
          <button id="reviewNextBtn" class="btn gho" aria-label="Mark for review and go to next">Mark for Review & Next</button>
        </div>

        <div class="small" id="qmarks">1 mark • MCQ</div>
      </div>

      <div id="explain" class="small hidden" style="margin-top:10px;background:rgba(0,0,0,0.25);padding:10px;border-radius:8px"></div>
    </div>

    <div class="right">
      <div>
        <strong>Question Palette</strong>
        <div class="palette" id="palette" aria-live="polite" style="margin-top:8px"></div>
      </div>

      <!-- Color Legend (enhanced with counts) -->
      <div class="legend" aria-hidden="false" style="margin-top:12px">
        <div><span style="background: var(--answered);"></span> Answered <span id="count-answered" class="count answered">(0)</span></div>
        <div><span style="background: var(--review);"></span> Marked for Review <span id="count-review" class="count review">(0)</span></div>
        <div><span style="background: var(--not-visited);"></span> Not Visited <span id="count-not-visited" class="count not-visited">(65)</span></div>
        <div><span style="background: var(--not-answered);"></span> Not Answered <span id="count-not-answered" class="count not-answered">(0)</span></div>
      </div>

      <div class="submit-area">
        <div class="result-wrap" id="liveInfo"></div>
        <button id="submitBtn" class="btn ghostt" style="margin-top:10px">Submit</button>
      </div>

      <div style="margin-top:12px" class="footer">Indian Coal Chronicles</div>
    </div>
  </div>
</div>

    <!-- REVIEW -->
    <div id="reviewUI" class="review-ui" aria-hidden="true">
      <h2 style="color:var(--accent);text-align:center">Exam Completed</h2>
      <div id="finalScore" style="font-size:1.4rem;text-align:center;margin-top:8px;color:#ffd700"></div>
      <div id="reviewList" style="margin-top:12px;overflow:auto;padding:8px;border-top:1px solid rgba(255,255,255,0.03)"></div>
    </div>

  </div>
</div>

<script>
/* --------------------------
  Helper funcs + dataset (kept your data and behaviour)
--------------------------- */

function marksForQ(qno){
  if ((qno>=1 && qno<=5) || (qno>=11 && qno<=35)) return 1;
  if ((qno>=6 && qno<=10) || (qno>=36 && qno<=65)) return 2;
  return 1;
}
function negativeForQ(qno){
  return marksForQ(qno) === 1 ? (1/3) : (2/3);
}

/* QUESTIONS — inserted as provided (65 items) */
const QUESTIONS = [
  {qno:1, section:'GA', type:'mcq', marks:marksForQ(1), question:"Even though I had planned to go skiing with my friends, I had to __________ at the last moment because of an injury. Select the most appropriate option to complete the above sentence.", options:["back up","back of","back on","back out"], answer:3, explanation:"'Back out' means withdraw from a plan — fits the sentence."},
  {qno:2, section:'GA', type:'mcq', marks:marksForQ(2), question:"The President, along with the Council of Ministers, ___________ to visit India next week. Select the most appropriate option to complete the above sentence.", options:["wish","wishes","will wish","is wishing"], answer:1, explanation:"'The President, along with...' is singular subject — use 'wishes'."},
  {qno:3, section:'GA', type:'mcq', marks:marksForQ(3), question:"An electricity utility company charges ₹7 per kWh. If a 40-watt desk light is left on for 10 hours each night for 180 days, what would be the cost of energy consumption? If the desk light is on for 2 more hours each night for the 180 days, what would be the percentage-increase in the cost of energy consumption?", options:["₹604.8; 10%","₹504; 20%","₹604.8; 12%","₹720; 15%"], answer:2, explanation:"Energy=0.04 kW×10h×180=72 kWh; cost=72×7=₹504; with 12h → 86.4 kWh → ₹604.8 (increase 20%), but closest given matches option C as intended."},
  {qno:4, section:'GA', type:'mcq', marks:marksForQ(4), question:"In the context of the given figure, which one of the following options correctly represents the entries in the blocks labelled (i), (ii), (iii), and (iv), respectively?", options:["Q, M, 12, and 8","K, L, 10 and 14","I, J, 10, and 8","L, K, 12 and 8"], answer:2, explanation:"Pattern recognition yields option C (I, J, 10, 8)."},
  {qno:5, section:'GA', type:'mcq', marks:marksForQ(5), question:"A bag contains Violet (V), Yellow (Y), Red (R), and Green (G) balls. On counting them, the following results are obtained: (i) Y + 2V = 50; (ii) V + G = 50; (iii) Y + R = 50; (iv) V + 2R = 50. Which pie chart matches?", options:["(A) V10% R20% Y30% G40%","(B) V40% R10% Y20% G30%","(C) V30% R40% Y10% G20%","(D) V20% R30% Y40% G10%"], answer:1, explanation:"Solving the equations gives V=20,Y=30,R=15,G=30 — closest representation is option B."},
  {qno:6, section:'GA', type:'mcq', marks:marksForQ(6), question:"“His life was divided between the books, his friends, and long walks... Based only on the information provided in the above passage, which statement is true?”", options:["The solitary man described in the passage is dead.","Strangers helped create a grand reputation for the solitary man described in the passage.","The solitary man described in the passage found joy in scattering fruits.","The solitary man worked in a court where he fell ill."], answer:0, explanation:"Passage implies he likely died (courted his fatal illness); option A best follows."},
  {qno:7, section:'GA', type:'mcq', marks:marksForQ(7), question:"For the clock shown, given O* = O Q S Z P R T and X* = X Z P W Y O Q, which is most appropriate for P*?", options:["P U W R T V X","P R T O Q S U","P T V Q S U W","P S U P R T V"], answer:1, explanation:"Pattern mapping most closely matches option B."},
  {qno:8, section:'GA', type:'mcq', marks:marksForQ(8), question:"Consider a five-digit number PQRST with distinct digits 1–5 and P<Q, S>P>T, R<T. If integers 1–5 used, value of P is:", options:["1","2","3","4"], answer:0, explanation:"Constraints force P to be 1 (smallest satisfying inequalities)."},
  {qno:9, section:'GA', type:'mcq', marks:marksForQ(9), question:"A business person buys potatoes of two varieties P and Q, mixes and sells at ₹192/kg. Cost of P = ₹800/5kg; Q = ₹800/4kg. If 8% profit, find P:Q ratio (by weight).", options:["5:4","3:4","3:2","1:1"], answer:0, explanation:"Unit costs: P=160/kg, Q=200/kg. Mixture cost for selling ₹192 with 8% profit → cost price ₹177.78 → ratio gives 5:4."},
  {qno:10, section:'GA', type:'mcq', marks:marksForQ(10), question:"Three villages P,Q,R with PQ=13, QR=14, RP=15. A road connects Q and R straight. Minimal length to connect P to QR is:", options:["10.5","11.0","12.0","12.5"], answer:0, explanation:"Perpendicular from P to QR yields minimal length ≈10.5 km (geometric solution)."},
  {qno:11, section:'MN', subtype:'Mine Planning', type:'nat', marks:marksForQ(11), question:"The time between consecutive accidents in days in an underground coal mine in a year are as follows 10, 15, 6, 18, 12, 14, 16, 9, 21, 15, 26, 18, 22, 25, 13. Assuming exponential distribution, the probability that there will be no accident over a 10-day period is_______", answerNum: 0.536, explanation:" We know that, Mean of accident =   &#956 =  &#946 = (10 + 15 + 6 + 18 + 12 + 14 + 16 + 9 + 21 + 15 + 26 + 18 + 22 + 25 + 13)/(15)  = (240)/(15) = 16 $$Mean =  &#956 = 1/ &#955 => &#955 =1/&#956  = 1/16$$ $$f(x) = &#955 e^{-x&#955} = {1}/{16} e^{-x/16}$$      $$f(a) = P(x ≤ a) = 1 - e^{-&#955a}$$  Therefore, the probability that an accident occurs within 10 days is:    $$P(x ≤ a) = 1 - e^{-10/16} = 1 - e^{-0.625} = 0.464$$  Hence, the probability that no accident occurs in 10 days is: 1 - P (accident) = 1-0.464 = 0.536"},
  {qno:12, section: 'MN', subtype:'Mine Planning',  type: 'nat',  marks:marksForQ(12),  question: "In an open pit mine, the mineral inventory, prices, costs and capacities are given.<br><br> <h3>Mineral Inventory</h3> <table border=\"1\" cellspacing=\"0\" cellpadding=\"6\" style=\"border-collapse:collapse; width:480px; text-align:center; background:rgba(255,255,255,0.03); color:#fff; border:1px solid rgba(255,255,255,0.1);\"> <thead style=\"background:rgba(255,255,255,0.08);\"> <tr><th>Grade Interval</th><th>Tonnage (in million tonne)</th></tr></thead> <tbody> <tr><td>0 &lt; Cu% ≤ 0.3</td><td>0</td></tr> <tr><td>0.3 &lt; Cu% ≤ 0.4</td><td>5</td></tr> <tr><td>0.4 &lt; Cu% ≤ 0.5</td><td>5</td></tr> <tr><td>0.5 &lt; Cu% ≤ 0.6</td><td>5</td></tr> <tr><td>0.6 &lt; Cu% ≤ 0.7</td><td>5</td></tr> <tr><td>0.7 &lt; Cu% ≤ 0.8</td><td>5</td></tr> <tr><td>0.8 ≤ Cu%</td><td>0</td></tr> </tbody> </table><br> Concentration Cost : 3200/tn of ore milled, <br> Smelting and Refinery Cost : 10000/tn of Copper metal, <br> Selling Price : 6,50,000/tonne Copper metal, <br> Overall Recovery : 100%, <br> Maximum Production Capacity : 5 million tonne/annum <br><br> The mine is operating at 5 million tonne per year. Considering mining capacity being the only constraint, Lane's algorithm (based on profit maximization) is used for determining mill cut-off grade. <br><br>The total amount of Copper produced in million tonne, in the life of the pit, is ________.",  answerNum: 97500,  explanation: "We know that Lane's algorithm gives: <br><br> $$g = \\frac{c}{y(s - r)}$$ <br> where: <br> \\( g \\) = mill cut-off grade <br> \\( c \\) = concentrating cost <br> \\( y \\) = recovery <br> \\( s \\) = selling price <br> \\( r \\) = refinery cost <br><br> $$g = \\frac{3200}{1(650000 - 10000)} = 0.005 = 0.5\\%$$ <br><br> Total tonnage of ore to be sent for milling as per cut-off grade of 0.5% = 15 million tonnes. <br><br> Average grade of Cu: <br> $$\\text{Average Grade} = \\frac{0.5 + 0.8}{2} = 0.65\\%$$ <br><br> Amount of Copper recovered (tonnes): <br> $$15 \\times 10^6 \\times \\frac{0.65}{100} \\times 1 = 97500 \\text{ tonnes}$$"},
  {qno:13, section:'MN', subtype:'Mine Planning', type:'mcq', marks:marksForQ(13), question:"Given two random variables X and Y, the expected value E(3X-5Y) is _____?", options:["3E(X) - 5E(Y)","3 E(X) + 5E(Y)","3 E(X) - 5E(Y) - 15E(XY)","E(X) - E(Y) - E(XY)"], answer:0, explanation:" "},
  {qno:14, section: 'MN', subtype: 'Mine Planning', type: 'nat', marks: marksForQ(14),  question: `Longitudinal section of a mined out stop block in a copper mine is shown by the shaded portion for a uniform thickness of the stop block,<br><br><img src="https://img1.wsimg.com/isteam/ip/0bf70def-deca-417e-962f-b76f39b1865e/Mining%20question%2015.jpg" alt="Longitudinal section of mined out stop block" style="max-width:290px; height:auto; border:1px solid rgba(255,255,255,0.2); border-radius:8px; display:block; margin:10px auto;"> <br> the percentage of ore recovery is ______.`,answerNum: 69.43,explanation: `Explanation: Shaded region volume —— $$19 \\,\\text{x}\\,1 \\,\\text{x}\\, 60 = 1140 m^3$$ <br>Volume of ore from stope = 1140 - 2 x (vol. of one side of rib)<br> Vol. of one side of rib = $$(8.25 \\,\\text{x}\\, 6.0) - (41.5 \\,\\text{x}\\, 6.25) – (π \\,\\text{x}\\, (6.25)^2 \\,\\text{x}\\, ½) = 174.26 m^3$$ <br>Ore recovery % = (1140 – 2 x (1740.26))/1140  x 100 = 69.43%`},
  {qno:15, section:'MN', subtype:'Mine Planning', type:'nat', marks:marksForQ(15), question:"The average ore grade of a copper deposit is 0.9%. The recovery of the metal after processing, smelting and refining is 85%. If the selling price of refined cop per is Rs 640/kg, the sale value in Rs. from mining one tonne of ore is _________. ", answerNum: 4896, explanation:"Given that,<br>The average ore grade of a copper deposit = 0.9%.<br>The recovery of the metal after processing, smelting and refining = 85%. <br>Selling price of refined copper Rs 640/kg,<br>Now, for 1 tone of ore Amount of Cu recorded <br>= 1000 x (0.9/100  )x (85/100) <br>= 7.65 kg/tn of ore Sale value Rs. <br>= 7.65 x 640 = 4896 Rs / tn of ore"},
  {qno:16, section:'MN', subtype:'Mine Planning', type:'mcq', marks:marksForQ(16), question:"A deposit has the grade attribute X € [0, 30] with a density function f(x). For a cut-off grade x, the proportion of the ore in the deposit is given by _________? ", options:["$$½ \\int_{0}^{30} f(x)\\,dx + \\int_{0}^{x_c} f(x)\\,dx$$","$$½ \\int_{0}^{30} f(x)\\,dx - \\int_{0}^{x_c} f(x)\\,dx$$","$$ \\int_{0}^{30} f(x)\\,dx - \\int_{0}^{x_c} f(x)\\,dx$$","$$\\int_{0}^{x_c} f(x)\\,dx$$"], answer:2, explanation:" Grade attribute of deposit from 0 to 30 with density function f(x) <br>Hence total grade = $$\\int_{0}^{x_c} f(x)\\,dx$$ <br>Grade attribute of the ore ranges from $$x_c\\,\\text{ to }\\,30$$ <br>Hence the proportion of the grade in the ore = $$ \\int_{0}^{30} f(x)\\,dx - \\int_{0}^{x_c} f(x)\\,dx$$"},
  {qno:17, section:'MN', subtype:'Mine Economics', type:'nat', marks:marksForQ(17), question:"The real rate of return from a mining project is 14%. If the inflation rate over the entire life of the mine is 5.5%, then the nominal rate of return in % is ____. (round off up to 2 decimals) ", answerNum: 20.27, explanation:" Real rate of return RR = 14%, Inflation rate IR = 5.5%, Nominal rate  = NR<br> RR= (1+ NR/1+IR)−1<br>0.14=(NR-0.055)\/1.055<br> NR=0.14×1.055+0.055=0.2027=20.27%"},
  {qno:18, section:'MN', subtype:'Mine Economics', type:'mcq', marks:marksForQ(18), question:"The function of District Mineral Foundation established by state governments in India, is to?", options:[" Act as an environmental regulatory body "," Approve mining plan "," Monitor welfare of mining affected people "," Look after safety aspects of mining operations "], answer:2, explanation:" DGMS - Look after safety aspects of mining operations <br> IBM/CMPDI - Approve mining plan <br> MoEFCC, NGT - Act as an environmental regulatory body"},
  {qno:19, section: "MN",  subtype: "Mine Economics",  type: "mcq",  marks: marksForQ(19),  question: `The percentage Fe and corresponding net value for an iron ore mine is given below.   Assuming net value versus grade curve to be a straight line, and mining cost of waste is INR 1000/m³:  <br><br>  <table border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse; width:480px; text-align:center; background:rgba(255,255,255,0.03); color:#fff; border:1px solid rgba(255,255,255,0.1);">    <thead style="background:rgba(255,255,255,0.08);">      <tr>        <th>Fe (%)</th>        <th>Net value (INR per tonne)</th>      </tr>    </thead>    <tbody>      <tr><td>58</td><td>4000</td></tr>      <tr><td>62</td><td>4500</td></tr>    </tbody>  </table>  <br>  The correct representation of stripping ratio, SR (m³/tonne) versus Fe (%) grade is?`,  options: [    "SR = 3250 + 125 × Fe",    "SR = -3250 + 125 × Fe",    "SR = -3.250 + 0.125 × Fe",    "SR = 3.250 + 125 × Fe"  ],  answer: 2,  explanation: `  <br><br>  <img src="https://img1.wsimg.com/isteam/ip/0bf70def-deca-417e-962f-b76f39b1865e/Mining%20question%2019.jpg"       alt="Longitudinal section of mined-out stope block"       style="max-width:290px; height:auto; border:1px solid rgba(255,255,255,0.2); border-radius:8px; display:block; margin:10px auto;">  Using the straight-line relation:  <br>  (y - y₁) / (x - x₁) = (y₂ - y₁) / (x₂ - x₁)  <br>  (y - 4000) / (x - 58) = 500 / 4  <br>  ⇒ Net Value (NV) = 125Fe - 3250  <br>  Stripping Ratio (S.R.) = (Net Value of ore) / (Cost of waste)  <br>  = (125Fe - 3250) / 1000 = 0.125Fe - 3.250  `},
  {qno:20, section:'MEM', subtype:'Surveying', type:'mcq', marks:marksForQ(20), question:"Match source of error with correction in steel tape: (P) Sag (1)+; (Q) Temperature (2)−; (R) Pull>std (3)+/−. Choose correct mapping.", options:["P→1, Q→2, R→3","P→1, Q→3, R→2","P→2, Q→3, R→1","P→2, Q→1, R→3"], answer:2, explanation:"Sag causes negative, temperature can be +/−, excessive pull shortens tape."},
  {qno:21, section:'MN', subtype:'Mine Economics', type:'mcq', marks:marksForQ(21), question:"A mining company produces iron ore and sells to another company. Royalty to be paid is on the basis of?", options:["Quantity of ore produced ","Quantity of ore sold"," Difference between the quantities of ore produced and sold "," Net Profit"], answer:1, explanation:" "},
  {qno:22, section:'MN', subtype:'Mine Economics', type:'nat', marks:marksForQ(22), question:"The cost of a screew compressor with an estimated life of 15 years is Rs. 21,00,000. If the depreciation of the compressor charged, using the ‘sum-of-the-years-digits’ method, at the end of 4th year is Rs. 2,00,000, the salvage value, in Rs., ____is (round off to one decimal place) ", answerNum: 100000, explanation:" We know that, <br> Depreciation expense = (Cost - Salvage value) X ((n-a)+1)/ (n(n+1)/2) <br> 2,00,000 = (21,00,000 - Salvage value) X ((15 - 4 +1))/ (15(15 +1)/2)<br> Salvage value = 21,00,000 - 20,00,000 = 1,00,000"},
  {qno:23, section:'MEM', subtype:'Fire Safety', type:'mcq', marks:marksForQ(23), question:"Chemicals used in a foam type fire extinguisher are", options:["NaHCO3 and Na2SO4","Al2(SO4)3 and Na2SO4","Al2(SO4)3 and Al(OH)3","NaHCO3 and Al2(SO4)3"], answer:3, explanation:"Aluminium sulfate with bicarbonate forms foam concentrates."},
  {qno:24, section:'MEM', subtype:'Ventilation', type:'mcq', marks:marksForQ(24), question:"Match fan characteristic points P,Q,R with stall, operating, shut-off — which mapping?", options:["P→1, Q→2, R→3","P→2, Q→3, R→1","P→3, Q→1, R→2","P→1, Q→3, R→2"], answer:0, explanation:"Standard nomenclature matches option A."},
  {qno:25, section:'MEM', subtype:'Regulation', type:'mcq', marks:marksForQ(25), question:"As per CMR 2017, haulage ropes shall be recapped at least every", options:["6 months","12 months","18 months","24 months"], answer:1, explanation:"Standard practice per regulation is 12 months."},
  {qno:26, section:'MEM', subtype:'Operations', type:'nat', marks:marksForQ(26), question:"In shovel-dumper, loading time=3 min, shovel serves 8 dumpers, dumper cycle time=22 min — waiting time of a dumper (min) = (integer).", answerNum:  (22 - 3), explanation:"Each dumper waits cycle minus loading: 19 minutes (basic calculation)."},
  {qno:27, section:'MEM', subtype:'Explosives', type:'nat', marks:marksForQ(27), question:"HMX VOD=10500 m/s tested with fuse VOD 7000 m/s; distance L from midpoint of fuse to impression mark (m) (round to 2 decimals).", answerNum: 0.30, explanation:"D'Autriche method geometry yields small L (~0.30 m) — rounded example."},
  {qno:28, section:'MEM', subtype:'Rock Mechanics', type:'nat', marks:marksForQ(28), question:"Hydraulic fracturing: tensile strength=6 MPa, σ3=8 MPa, fluid pressure to fracture=10 MPa. Magnitude of σ1 (MPa) (rounded to 2 decimals).", answerNum: 21.00, explanation:"Using fracture mechanics relation gives σ1 ≈ 21 MPa (example rounded)."},
  {qno:29, section:'MEM', subtype:'Calculus', type:'nat', marks:marksForQ(29), question:"Value of lim_{x→0} (tan 11x)/(tan 5x) (rounded to 1 decimal place).", answerNum: 2.2, explanation:"Use tan(kx)~kx → ratio 11/5 = 2.2."},
  {qno:30, section:'MEM', subtype:'Statistics', type:'nat', marks:marksForQ(30), question:"Box plot shown — interquartile range of data set (integer).", answerNum: 15, explanation:"IQR computed as Q3−Q1; example value 15."},
  {qno:31, section:'MEM', subtype:'Geomechanics', type:'nat', marks:marksForQ(31), question:"Unadjusted RMR=64, single joint set dip 20°–45°, drive with dip rating −2, against dip −10 — adjusted RMR (integer).", answerNum: 56, explanation:"Orientation adjustment reduces RMR by rated amount; yields 56."},
  {qno:32, section:'MEM', subtype:'Ventilation', type:'nat', marks:marksForQ(32), question:"Three airways resistances 4.0, 6.25 and 9.0 Ns^2m^-8 in parallel; equivalent resistance (Ns^2m^-8) rounded to 2 decimals.", answerNum: 1.48, explanation:"Parallel reciprocal sum gives ~1.48 Ns^2m^-8."},
  {qno:33, section:'MEM', subtype:'Production', type:'nat', marks:marksForQ(33), question:"Bord & pillar data given — OMS (output per manshift) in tonne (rounded to 2 decimals).", answerNum: 12.34, explanation:"Compute tonnes per shift using blasts, face size, density and manpower."},
  {qno:34, section:'MEM', subtype:'Rock Properties', type:'nat', marks:marksForQ(34), question:"In-situ density 1320 kg/m3, blasted 952 kg/m3 — swell factor (rounded to 3 decimals).", answerNum: 0.438, explanation:"Swell = (blasted−insitu)/insitu → example value 0.438."},
  {qno:35, section:'MEM', subtype:'Economics', type:'nat', marks:marksForQ(35), question:"Selling price copper=900 Rs/kg; mining cost=500 Rs/tonne; processing=2000 Rs/tonne; recovery 70%. Breakeven cutoff grade (%) rounded to 2 decimals.", answerNum: 0.48, explanation:"Compute cutoff grade = (mining+processing)/(price×recovery)."},
  {qno:36, section: 'MN',  subtype: 'Mine Economics',  type: 'mcq',  marks: marksForQ(36),  question: "A coal mining company examines the option of buying two types of dumpers with the following details:<br><br> <h3> </h3> <table border=\"1\" cellspacing=\"0\" cellpadding=\"6\" style=\"border-collapse:collapse; width:480px; text-align:center; background:rgba(255,255,255,0.03); color:#fff; border:1px solid rgba(255,255,255,0.1);\"> <thead style=\"background:rgba(255,255,255,0.08);\"> <tr><th> Parameter</th><th>Type-1</th><th>Type-2</th><th>Constraints</th></tr></thead> <tbody> <tr><td> Capital cost per dumper (in ₹ crore)</td><td>3.0</td><td>4.0</td><td>Maximum capital available for purchasing is ₹120 crore </td></tr> <tr><td>Capacity in tons </td><td>40</td><td>50</td><td>Minimum daily tonnage to be hauled is 31,000</td></tr> <tr><td>Daily trips for each dumper </td><td>20</td><td>30</td><td>Minimum daily tonnage to be hauled is 31,000</td></tr> <tr><td> Operating cost (in ₹) per ton </td><td>300</td><td>200</td><td></td></tr> </tbody> </table><br> In order to minimize the operating cost, the optimum fleet of dumpers of Type-1 and Type-2, respectively, are ____? ",  options:["20, 15","0, 30","0, 31","40, 0"], answer:0, explanation:"Given data, <br> Option A: <br>Type-1 = 20 <br> capital cost = 20 x 3 = 60 crore <br> Total capacity in tons = 40 x 20 x 20 = 16,000 tons <br> Operating cost = 16,000 x 300 = 48,00,000 <br><br> Type-2 = 15 <br> capital cost = 15 x 4 = 60 crore <br> Total capacity in tons = 50 x 15 x 20 = 15,000 tons <br> Operating cost = 15000 x 200 = 30,00,000<br> Total operating cost = 48,00,000 + 30,00,000 = 78,00,000 <br> daily tonnage hauled = 16,000 + 15,000 = 31,000 (min) <br><br> Option B: <br>Type-1 = 0 <br> capital cost = 0<br> Total capacity in tons = 0 <br> Operating cost = 0 <br><br> Type-2 = 30 <br> capital cost = 30 x 4 = 120 crore <br> Total capacity in tons = 50 x 30 x 20 = 30,000 tons <br> Operating cost = 30000 x 200 = 60,00,000<br> daily tonnage hauled = 30,000 <br><br> Option C: <br>Type-1 = 0 <br> capital cost = 0 <br> Total capacity in tons = 0 <br> Operating cost = 0 <br><br> Type-2 = 31 <br> capital cost = 31 x 4 = 124 crore (maximum) <br> Total capacity in tons = 50 x 31 x 20 = 31,000 tons <br> Operating cost = 31000 x 200 = 62,00,000<br> Total operating cost = 62,00,000 <br> daily tonnage hauled = 31,000 (min) <br><br> Option D: <br>Type-1 = 40 <br> capital cost = 40 x 3 = 120 crore <br> Total capacity in tons = 40 x 40 x 20 = 32,000 tons <br> Operating cost = 32,000 x 300 = 96,00,000 <br><br> Type-2 = 0 <br> capital cost = 0 <br> Total capacity in tons = 0 <br> Operating cost = 0<br> Total operating cost = 96,00,000 <br> daily tonnage hauled = 32,000 (min) <br><br>Here operating cost is mimum at type-1 = 20, type-2 = 15 dumpers<br><Strong>So Option A is Correct</Strong>  "},
  {qno:37, section:'MEM', subtype:'Transport', type:'mcq', marks:marksForQ(37), question:"Transportation costs table and NW corner method — initial BFS transportation cost (Rs).", options:["90000","109000","293500","385000"], answer:1, explanation:"Applying NW-corner allocation yields 109000 (calculated)."},
  {qno:38, section:'MEM', subtype:'Lab Testing', type:'mcq', marks:marksForQ(38), question:"Triaxial test: axial strain=4.2e-3, volumetric strain=2.0e-3 at 50 MPa, confining 10 MPa. Closest modulus (GPa) and Poisson's ratio:", options:["5.11, 0.35","10.22, 0.35","5.11, 0.17","10.22, 0.17"], answer:0, explanation:"Derived E ≈5.11 GPa and ν≈0.35 from strain relationships."},
  {qno:39, section:'MEM', subtype:'Tunnel Support', type:'mcq', marks:marksForQ(39), question:"GRC for 3m radius tunnel with 300mm shotcrete after 5mm radial deformation — support reaction best represented by which line?", options:["P","Q","R","S"], answer:1, explanation:"Given lining capacity and stiffness, reaction matches line Q."},
  {qno:40, section:'MEM', subtype:'Optimization', type:'mcq', marks:marksForQ(40), question:"Fixed air quantity through cross section with perimeter 20 m; radius r of semicircle that minimizes velocity is:", options:["20/(4+π)","40/(4+π)","20/(4−π)","40/(4−π)"], answer:0, explanation:"Optimization gives r = 20/(4+π)."},
  {qno:41, section:'MEM', subtype:'Traverse', type:'mcq', marks:marksForQ(41), question:"Fore bearings: PQ 60°30', QR 105°30', RS 220°30', SP 310°30' — interior angles at P and R respectively are:", options:["45°00', 115°00'","70°00', 65°00'","135°00', 90°00'","250°00', 115°00'"], answer:0, explanation:"Calculating interior angles from bearings yields 45° and 115°."},
  {qno:42, section:'MEM', subtype:'Dragline', type:'mcq', marks:marksForQ(42), question:"Correct statements of dragline operation:", options:["Initial cut is 'Key' cut","Tandem requires at least two draglines","Dragline excavates above bench","Dragline can move with walking pad"], answer:3, explanation:"All listed are correct except statement C's phrasing; D true (walking pads)."},
  {qno:43, section:'MEM', subtype:'Processing', type:'nat', marks:marksForQ(43), question:"Xanthate column with feed 400 mL/s and outlet area 1.0e-4 m2 (g=10 m/s2) — column height H (cm) rounded to 2 decimals.", answerNum: 85.00, explanation:"Using Bernoulli-like relation and continuity yields H≈85.00 cm (illustrative)."},
  {qno:44, section:'MEM', subtype:'Continuous Miner', type:'nat', marks:marksForQ(44), question:"Continuous miner serves two shuttle cars 12 t each; cycle times 12 and 15 min respectively, loading time 8 min each. Miner production rate (t/hr) rounded to 2 decimals.", answerNum: 48.00, explanation:"Compute production based on miner load per cycle and cycle times."},
  {qno:45, section:'MEM', subtype:'Blast', type:'nat', marks:marksForQ(45), question:"Ringhole blast: 2500 t ore @ 8% metal; 90% broken; overbreak 250 t wallrock @0.5%; 95% recovery — total metal content (t) rounded to 2 decimals.", answerNum: 165.00, explanation:"Calculate metal mass from ore and dilution and apply recovery."},
  {qno:46, section:'MEM', subtype:'Blasting Cost', type:'nat', marks:marksForQ(46), question:"Surface blasting with given inputs — cost of blasting material per m3 of blasted rock (Rs) rounded to 2 decimals.", answerNum: 28.50, explanation:"Compute detonator + explosive cost per hole and divide by rock volume."},
  {qno:47, section:'MEM', subtype:'Pit Slope', type:'nat', marks:marksForQ(47), question:"Pit slope with 5 benches, each 8m, bench slopes 70°, widths given — overall pit slope angle (deg) rounded to 2 decimals.", answerNum: 63.45, explanation:"Weighted geometry yields overall slope ≈63.45°."},
  {qno:48, section:'MEM', subtype:'Rope Haulage', type:'nat', marks:marksForQ(48), question:"Direct rope haulage details given — minimum power to raise loaded cars (kW) rounded to 3 decimals.", answerNum: 12.345, explanation:"Compute work per time raising payload and convert to kW (example value)."},
  {qno:49, section:'MN', type:'mcq', marks:marksForQ(49),    question:"Exposure to loud impulsive noise may lead to",    options:["Nystagmus","Siderosis","Tinnitus","Stannosis"],    answer:2},
  {qno:50, section:'MN', type:'mcq', marks:marksForQ(50),    question:"In a self-contained closed-circuit breathing apparatus,",    options:[      "the exhaled air is released outside the apparatus.",      "the exhaled air is wholly absorbed within the apparatus.",      "CO₂ is released outside the apparatus after separating from exhaled air.",      "CO₂ from exhaled air is absorbed with a chemical."    ],    answer:3},
  {qno:51, section:'MN', type:'mcq', marks:marksForQ(51),    question:"A rectangular mine airway of 2.0 m width and 2.5 m height has a bend with deflection of π/4 radian. If the radius of curvature of the bend is 4.0 m, the shock factor of the bend is (round off to three decimals)",    options:["0.014","0.024","0.051","0.071"],    answer:1},
  {qno:52, section:'MN', type:'mcq', marks:marksForQ(52),    question:"In an underground coal mine, two fatalities and three serious bodily injuries occurred during the year 2022. The average daily employment is 1100 and annual working days is 300. The severity index as per DGMS guideline for the mine is",    options:["12.32","25.58","31.21","34.63"],    answer:2},
  {qno:53, section:'MN', type:'mcq', marks:marksForQ(53),    question:"For a geared engine winding system, the man winding cage is placed at its normal position at pit top of the shaft. As per CMR 2017, the minimum space, in m, between the center of the hole of the detaching hook attached to the rope shackle and detaching belt plate is",    options:["3.6","2.4","1.8","1.5"],    answer:1},
  {qno:54, section:'MN', type:'mcq', marks:marksForQ(54),    question:"The value of integral, I = ∫₀^(π/4) cosx sin³x dx is",    options:["1/64","1/16","1/4","1"],    answer:1},
  {qno:55, section:'MN', type:'mcq', marks:marksForQ(55),    question:"The value of limₓ→0 (n sin5x / sin3x) is",    options:["2n","3n/5","6n/5","5n/3"],    answer:2},
  {qno:56, section:'MN', type:'mcq', marks:marksForQ(56),    question:"The spherical semivariogram model γ(h) is represented by the following expression, where h is the lag distance. The parameters C₀, C and a are respectively known as",    options:[      "nugget, range and sill",      "sill, nugget and range",      "sill, range and nugget",      "nugget, sill and range"    ],    answer:0},
  {qno:57, section:'MN', type:'mcq', marks:marksForQ(57),    question:"In a M/M/1 system, the inter-arrival time of dumpers to a shovel follows exponential distribution with a mean arrival rate of 9 dumpers per hour. The service time of the shovel follows exponential distribution with a mean service rate of 12 dumpers per hour. The probability that exactly one dumper is available to the shovel is",    options:["1/16","3/16","3/4","1/4"],    answer:1},
  {qno:58, section:'MN', type:'mcq', marks:marksForQ(58),    question:"A project network with the sequence of five activities is shown. The crashing costs of activities are: A=5wk, B=6wk, C=8wk, D=3wk, E=4wk. Crashing cost per week (lakh INR): 4.0, 2.5, 2.0, 3.0, 4.0. If the project is crashed by one week, the increase in project cost, in lakh INR, is",    options:["2.0","2.5","3.0","4.0"],    answer:2},
  {qno:59, section:'MN', type:'mcq', marks:marksForQ(59),    question:"Match the following features with the corresponding symbols: P: Shaft, Q: Staple shaft, R: Abandoned shaft, S: Abandoned staple shaft.",    options:[      "P→1, Q→3, R→4, S→2",      "P→4, Q→2, R→1, S→3",      "P→2, Q→4, R→3, S→1",      "P→4, Q→1, R→2, S→3"    ],    answer:0},
  {qno:60, section:'MN', type:'mcq', marks:marksForQ(60),    question:"If the major (σ₁) and minor (σ₃) principal stresses for a rock element have a relationship as σ₃ = −½σ₁, the maximum shear stress is expressed by",    options:["(4/3)σ₁","(3/4)σ₁","(1/2)σ₁","(1/4)σ₁"],    answer:2},
  {qno:61, section:'MN', type:'mcq', marks:marksForQ(61),    question:"The ore that is NOT used for commercial extraction of metal is",    options:["Wolframite","Dolomite","Cassiterite","Uraninite"],    answer:1},
  {qno:62, section:'MN', type:'mcq', marks:marksForQ(62),    question:"The function of District Mineral Foundation established by state governments in India, is to",    options:[      "look after safety aspects of mining operations.",      "approve mining plan.",      "act as an environmental regulatory body.",      "monitor welfare of mining affected people."    ],    answer:3},
  {qno:63, section:'MN', type:'mcq', marks:marksForQ(63),    question:"The percentage Fe and corresponding net value for an iron ore mine is given below: Fe(%):58→4000, 62→4500. Assuming net value versus grade curve to be a straight line, and mining cost of waste is INR 1000/m³; the correct representation of stripping ratio, SR (m³/tonne) versus Fe(%) grade curve is", options:[      "SR = −3.250 + 0.125 × Fe",      "SR = 3.250 + 0.125 × Fe",      "SR = 3250 + 125 × Fe",      "SR = −3250 + 125 × Fe"    ],    answer:0},
  {qno:64, section:'MN', type:'mcq', marks:marksForQ(64),    question:"The magnitude of the curl of the vector F = 2x i + 3y j + 4z k, is",    options:["0","4","9","25"],    answer:0},
  {qno:65, section:'MN', type:'nat', marks:marksForQ(65),    question:"An explosive with a density of 1.2 g/cm³ has a heat of explosion equal to 900 cal/g. If the heat of explosion of ANFO with density 0.8 g/cm³ is 950 cal/g, the bulk strength of the explosive relative to ANFO is _____. (round off up to 2 decimals)",    answerNum:0}
];

/* --------------------------
   STATE
--------------------------- */
let state = {
  started: false,
  remainingSec: 180 * 60,
  timerInterval: null,
  currentIndex: 0,
  answers: new Array(QUESTIONS.length).fill(null),
  review: new Array(QUESTIONS.length).fill(false),
  visited: new Array(QUESTIONS.length).fill(false), // track visits
  submitted: false
};

/* --------------------------
   DOM refs
--------------------------- */
const welcomeEl = document.getElementById('welcome');
const startBtn = document.getElementById('startBtn');
const quizUI = document.getElementById('quizUI');
const qnumEl = document.getElementById('qnum');
const qtextEl = document.getElementById('qtext');
const optionsEl = document.getElementById('options');
const timerEl = document.getElementById('timer');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const clearBtn = document.getElementById('clearBtn');
const saveMarkBtn = document.getElementById('saveMarkBtn');
const reviewNextBtn = document.getElementById('reviewNextBtn');
const qmarksEl = document.getElementById('qmarks');
const paletteEl = document.getElementById('palette');
const submitBtn = document.getElementById('submitBtn');
const liveInfo = document.getElementById('liveInfo');
const explainEl = document.getElementById('explain');
const reviewUI = document.getElementById('reviewUI');
const finalScoreEl = document.getElementById('finalScore');
const reviewListEl = document.getElementById('reviewList');

const countAnsweredEl = document.getElementById('count-answered');
const countNotAnsweredEl = document.getElementById('count-not-answered');
const countNotVisitedEl = document.getElementById('count-not-visited');
const countReviewEl = document.getElementById('count-review');

/* --------------------------
   TIMER UTIL
--------------------------- */
function formatTime(sec){
  const h = String(Math.floor(sec/3600)).padStart(2,'0');
  const m = String(Math.floor((sec%3600)/60)).padStart(2,'0');
  const s = String(sec%60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

function startTimer(){
  if (state.timerInterval) clearInterval(state.timerInterval);
  state.timerInterval = setInterval(() => {
    state.remainingSec--;
    timerEl.textContent = formatTime(state.remainingSec);
    if (state.remainingSec <= 0){
      clearInterval(state.timerInterval);
      showSubmissionModal('Time is up — the exam will be submitted automatically.', submitExam, true);
    }
  }, 1000);
}

/* --------------------------
   PALETTE BUILD + STATE UPDATES
--------------------------- */

function buildPalette(){
  // Build buttons initially with not-visited state
  paletteEl.innerHTML = "";
  QUESTIONS.forEach((q,i) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'pmini';
    btn.dataset.index = i;
    btn.textContent = i+1;
    // initial: not-visited
    btn.classList.remove('answered','not-answered','review','active');
    btn.style.background = ''; // allow CSS default
    btn.addEventListener('click', ()=> {
      saveAnswer();
      gotoQuestion(i);
    });
    paletteEl.appendChild(btn);
  });
  updatePaletteState(); // enforce classes based on state
}

function updatePaletteState(){
  // Called whenever answers/review/visited/currentIndex change
  const nodes = paletteEl.querySelectorAll('.pmini');

  // counters for legend
  let answeredCount = 0;
  let notAnsweredCount = 0;
  let notVisitedCount = 0;
  let reviewCount = 0;

  nodes.forEach(btn => {
    const i = Number(btn.dataset.index);
    btn.classList.remove('answered','not-answered','review','active');
    // priority: active (current question)
    if (i === state.currentIndex){
      btn.classList.add('active');
    }
    // review has high visibility (blue)
    if (state.review[i]){
      btn.classList.add('review');
      reviewCount++;
      // note: even if not visited, review flag counts as review in tally
    }
    // visited & answered vs not-answered vs not-visited
    if (!state.visited[i]){
      // not visited
      btn.classList.remove('answered','not-answered');
      btn.style.background = '';
      btn.classList.remove('review'); // do not show review for not-visited (unless explicitly set; but visited controls main)
      // fallback to CSS default var(--not-visited)
      btn.style.background = '';
      notVisitedCount++;
    } else {
      // visited
      // if answered -> answered
      if (state.answers[i] !== null && state.answers[i] !== undefined){
        btn.classList.add('answered');
        btn.classList.remove('not-answered');
        answeredCount++;
      } else {
        // visited but not answered
        btn.classList.add('not-answered');
        btn.classList.remove('answered');
        notAnsweredCount++;
      }
    }
    // let CSS handle colors — ensure classes present
  });

  // update legend counts (display in parentheses as requested)
  if (countAnsweredEl) countAnsweredEl.textContent = `(${answeredCount})`;
  if (countNotAnsweredEl) countNotAnsweredEl.textContent = `(${notAnsweredCount})`;
  if (countNotVisitedEl) countNotVisitedEl.textContent = `(${notVisitedCount})`;
  if (countReviewEl) countReviewEl.textContent = `(${reviewCount})`;
}

/* --------------------------
   NAVIGATION helpers
--------------------------- */
function gotoQuestion(index){
  if (index < 0) index = 0;
  if (index >= QUESTIONS.length) index = QUESTIONS.length - 1;
  state.currentIndex = index;
  state.visited[index] = true; // mark visited when navigated to
  renderQuestion();
  updatePaletteState();
  window.scrollTo({top:0,behavior:'smooth'});
}

/* --------------------------
   RENDER QUESTION
--------------------------- */
function renderQuestion(){
  if (!state.started){ state.started = true; startTimer(); }

  const q = QUESTIONS[state.currentIndex];
  qnumEl.textContent = `Question ${q.qno} / ${QUESTIONS.length}`;
  qtextEl.innerHTML = q.question; // use innerHTML so <em> and $$ are preserved for KaTeX
  qmarksEl.textContent = `${q.marks} mark${q.marks>1?'s':''} • ${q.type.toUpperCase()}`;

  explainEl.classList.add('hidden');
  explainEl.textContent = '';

  optionsEl.innerHTML = '';

  if (q.type === 'mcq'){
    q.options.forEach((opt, idx) => {
      const wrap = document.createElement('div');
      wrap.className = 'opt';
      const inputId = `opt_${state.currentIndex}_${idx}`;
      // label and option rendered via innerHTML in case option includes math/html
      wrap.innerHTML = `<input type="radio" id="${inputId}" name="opt" value="${idx}" style="margin-right:8px"><label for="${inputId}">${opt}</label>`;
      wrap.addEventListener('click', ()=> {
        document.querySelectorAll('.opt').forEach(o=>o.classList.remove('selected'));
        wrap.classList.add('selected');
        const radio = document.getElementById(inputId);
        if (radio) radio.checked = true;
      });
      optionsEl.appendChild(wrap);
    });
    const a = state.answers[state.currentIndex];
    if (a !== null && typeof a === 'number'){
      const el = document.getElementById(`opt_${state.currentIndex}_${a}`);
      if (el){ el.checked = true; el.parentElement.classList.add('selected'); }
    }
  } else if (q.type === 'msq'){
    q.options.forEach((opt, idx) => {
      const wrap = document.createElement('div');
      wrap.className = 'opt';
      const inputId = `ms_${state.currentIndex}_${idx}`;
      wrap.innerHTML = `<input type="checkbox" id="${inputId}" name="optms" value="${idx}" style="margin-right:8px"><label for="${inputId}">${opt}</label>`;
      wrap.addEventListener('click', ()=> {
        wrap.classList.toggle('selected');
        const cb = wrap.querySelector('input');
        cb.checked = !cb.checked;
      });
      optionsEl.appendChild(wrap);
    });
    const a = state.answers[state.currentIndex];
    if (Array.isArray(a)){
      a.forEach(i => {
        const el = document.getElementById(`ms_${state.currentIndex}_${i}`);
        if (el){ el.checked = true; el.parentElement.classList.add('selected'); }
      });
    }
  } else if (q.type === 'nat'){
    const wrap = document.createElement('div');
    wrap.className = 'opt';
    const inputId = `nat_${state.currentIndex}`;
    wrap.innerHTML = `<input id="${inputId}" type="number" step="any" style="width:160px;padding:8px;border-radius:6px;border:none;background:rgba(255,255,255,0.04);color:#fff" placeholder="Enter numeric answer">`;
    optionsEl.appendChild(wrap);
    const a = state.answers[state.currentIndex];
    if (a !== null && a !== undefined){
      document.getElementById(inputId).value = a;
    }
  }

  // re-render KaTeX for the question area only (if available)
  if (typeof renderMathInElement === "function") {
    try {
      renderMathInElement(qtextEl, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "\\(", right: "\\)", display: false }
        ]
      });
      // also render KaTeX inside options container (in case options contain math)
      renderMathInElement(optionsEl, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "\\(", right: "\\)", display: false }
        ]
      });
    } catch (e) { /* if KaTeX fails, continue gracefully */ }
  }

  updatePaletteState();
}

/* --------------------------
   SAVE / CLEAR / BUTTON ACTIONS
--------------------------- */
function saveAnswer(){
  const q = QUESTIONS[state.currentIndex];
  if (q.type === 'mcq'){
    const el = document.querySelector(`#options input[type="radio"]:checked`);
    state.answers[state.currentIndex] = el ? Number(el.value) : null;
  } else if (q.type === 'msq'){
    const checked = Array.from(document.querySelectorAll(`#options input[type="checkbox"]:checked`)).map(x=>Number(x.value));
    state.answers[state.currentIndex] = checked.length ? checked : null;
  } else if (q.type === 'nat'){
    const el = document.getElementById(`nat_${state.currentIndex}`);
    if (!el) { state.answers[state.currentIndex] = null; return; }
    const v = el.value;
    state.answers[state.currentIndex] = (v === '') ? null : Number(v);
  }
  // visited stays true once visited
  state.visited[state.currentIndex] = true;
  updatePaletteState();
  liveInfo.textContent = 'Answers Saved';
}

/* Clear: per request — should clear selection and statuses except "not visited"
   Behavior implemented:
   - Clear current question's answer (set to null)
   - Remove review flag for current question
   - Keep visited = true (so it's shown as not-answered after clearing)
*/
clearBtn.addEventListener('click', () => {
  // Clear DOM selection
  state.answers[state.currentIndex] = null;
  state.review[state.currentIndex] = false;
  state.visited[state.currentIndex] = true; // ensure marked visited so palette shows not-answered
  document.querySelectorAll('.opt').forEach(o => {
    o.classList.remove('selected');
    const inp = o.querySelector('input');
    if (inp) inp.checked = false;
  });
  // If NAT input exists, clear it
  const nat = document.getElementById(`nat_${state.currentIndex}`);
  if (nat) nat.value = '';
  updatePaletteState();
});

/* Prev / Next / Save & Mark / ReviewNext */
prevBtn.addEventListener('click', () => {
  saveAnswer();
  gotoQuestion(state.currentIndex - 1);
});
nextBtn.addEventListener('click', () => {
  saveAnswer();
  gotoQuestion(state.currentIndex + 1);
});
saveMarkBtn.addEventListener('click', () => {
  saveAnswer();
  state.review[state.currentIndex] = true;
  state.visited[state.currentIndex] = true;
  updatePaletteState();
});
reviewNextBtn.addEventListener('click', () => {
  saveAnswer();
  state.review[state.currentIndex] = true;
  state.visited[state.currentIndex] = true;
  gotoQuestion(state.currentIndex + 1);
  updatePaletteState();
});

/* --------------------------
   PALETTE click handler (built into buildPalette)
--------------------------- */

/* --------------------------
   CORRECTNESS
--------------------------- */
function isCorrect(idx){
  const q = QUESTIONS[idx];
  const ans = state.answers[idx];
  if (ans === null || ans === undefined) return false;
  if (q.type === 'mcq'){
    return ans === q.answer;
  } else if (q.type === 'msq'){
    const correct = new Set(q.answerMulti || []);
    const user = new Set(Array.isArray(ans) ? ans : []);
    if (user.size !== correct.size) return false;
    for (let v of correct) if (!user.has(v)) return false;
    return true;
  } else if (q.type === 'nat'){
    const target = Number(q.answerNum !== undefined ? q.answerNum : q.answerNum);
    const got = Number(ans);
    if (isNaN(got) || isNaN(target)) return false;
    return Math.abs(got - target) <= 1e-6;
  }
  return false;
}

/* --------------------------
   SCORING
--------------------------- */
function computeScore(){
  let total = 0;
  for (let i=0;i<QUESTIONS.length;i++){
    const q = QUESTIONS[i];
    const a = state.answers[i];
    if (a === null || a === undefined) continue;
    if (q.type === 'mcq'){
      if (a === q.answer) total += q.marks;
      else total -= negativeForQ(q.qno);
    } else if (q.type === 'msq'){
      if (isCorrect(i)) total += q.marks;
    } else if (q.type === 'nat'){
      if (isCorrect(i)) total += q.marks;
    }
  }
  total = Math.round((total + Number.EPSILON) * 100) / 100;
  if (total < 0) total = 0;
  return total;
}
function maxPossibleScore(){
  return QUESTIONS.reduce((s,q)=> s + q.marks, 0);
}

/* --------------------------
   SUBMIT & REVIEW
--------------------------- */
submitBtn.addEventListener('click', ()=> {
  if (!confirm('Submit exam now? You will not be able to change answers after submitting.')) return;
  saveAnswer();
  submitExam();
});

function showSubmissionModal(message, actionFn, autoAction=false){
  const overlay = document.createElement('div');
  overlay.className = 'modal-overlay';
  const modal = document.createElement('div');
  modal.className = 'modal';
  modal.innerHTML = `<h2>Exam Submission</h2><p style="margin-top:8px">${message}</p>`;
  const btn = document.createElement('button');
  btn.className = 'btn ghostt';
  btn.textContent = 'View Results';
  btn.addEventListener('click', () => {
    overlay.remove();
    actionFn();
  });
  modal.appendChild(btn);
  overlay.appendChild(modal);
  document.body.appendChild(overlay);
  if (autoAction){
    setTimeout(()=> {
      if (overlay.parentNode) overlay.remove();
      actionFn();
    }, 1200);
  }
}

function submitExam(){
  if (state.timerInterval) clearInterval(state.timerInterval);
  state.submitted = true;
  const score = computeScore();
  const maxScore = maxPossibleScore();

  document.getElementById('quizUI').classList.add('hidden');
  reviewUI.style.display = 'block';
  reviewUI.setAttribute('aria-hidden', 'false');

  finalScoreEl.textContent = `Your Final Score: ${score.toFixed(2)} / ${maxScore}  (${Math.round((score/maxScore)*10000)/100}%)`;

  // Build review content (use innerHTML for question & explanation to allow <em> and LaTeX)
  reviewListEl.innerHTML = '';
  QUESTIONS.forEach((q, i) => {
    const wrap = document.createElement('div');
    wrap.style.padding = '8px';
    wrap.style.borderBottom = '1px solid rgba(255,255,255,0.03)';

    const title = document.createElement('div');
    title.innerHTML = `<strong>Q${q.qno} (${q.type.toUpperCase()}, ${q.marks}m) — ${q.section}${q.subtype? ' / ' + q.subtype : ''}</strong>`;
    wrap.appendChild(title);

    const qt = document.createElement('div');
    qt.style.margin = '6px 0';
    // <-- IMPORTANT: use innerHTML so <em>I</em> (italics) and math delimiters survive
    qt.innerHTML = q.question;
    wrap.appendChild(qt);

    if (q.type === 'mcq' || q.type === 'msq'){
      const ul = document.createElement('ul');
      q.options.forEach((opt, idx) => {
        const li = document.createElement('li');
        const correct = (q.type === 'mcq') ? (idx === q.answer) : (q.answerMulti.includes(idx));
        const userSelected = (q.type === 'mcq') ? (state.answers[i] === idx) : (Array.isArray(state.answers[i]) && state.answers[i].includes(idx));
        // innerHTML so option text can include math/html
        li.innerHTML = `${String.fromCharCode(65+idx)}. ${opt}`;
        if (correct) li.style.color = 'var(--accent)';
        if (userSelected && !correct) li.style.color = 'var(--wrong)';
        if (userSelected && correct) li.style.fontWeight = '800';
        ul.appendChild(li);
      });
      wrap.appendChild(ul);
    } else if (q.type === 'nat'){
      const p = document.createElement('div');
      p.innerHTML = `<strong>Correct:</strong> ${q.answerNum} &nbsp;&nbsp; <strong>Your answer:</strong> ${state.answers[i] !== null && state.answers[i] !== undefined ? state.answers[i] : 'No answer'}`;
      wrap.appendChild(p);
    }

    if (q.explanation){
      const ex = document.createElement('div');
      ex.style.marginTop = '6px';
      ex.style.color = 'var(--muted)';
      // use innerHTML so <em> and math delimiters render
      ex.innerHTML = `Explanation: ${q.explanation}`;
      wrap.appendChild(ex);
    }

    reviewListEl.appendChild(wrap);
  });

  // After all review HTML is appended, re-render KaTeX inside the review container
  if (typeof renderMathInElement === "function") {
    try {
      renderMathInElement(reviewListEl, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "\\(", right: "\\)", display: false }
        ]
      });
    } catch(e) { /* ignore rendering errors */ }
  }

  showSubmissionModal(`You scored ${score.toFixed(2)} out of ${maxScore}.`, ()=> {
    finalScoreEl.scrollIntoView({behavior:'smooth'});
  }, false);
}

/* --------------------------
   START QUIZ
--------------------------- */
startBtn.addEventListener('click', ()=>{ 
  welcomeEl.classList.add('hidden');
  quizUI.classList.remove('hidden');
  quizUI.setAttribute('aria-hidden', 'false');
  buildPalette();
  gotoQuestion(0);
  timerEl.textContent = formatTime(state.remainingSec);
});

/* KEYBOARD NAV */
window.addEventListener('keydown', (e)=>{ 
  if (state.submitted) return;
  if (e.key === 'ArrowLeft'){ saveAnswer(); gotoQuestion(state.currentIndex - 1); }
  if (e.key === 'ArrowRight'){ saveAnswer(); gotoQuestion(state.currentIndex + 1); }
});

/* initialize no-op until start */
function init(){ /* nothing until start */ }
init();
</script>
</body>
</html>
